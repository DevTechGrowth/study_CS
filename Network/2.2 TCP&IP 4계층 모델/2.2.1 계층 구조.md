### 인터넷 프로토콜 스위트 internet protocol suite
- 인터넷에서 컴퓨터들이 서로 **정보**를 주고 받는 데 쓰이는 **프로토콜 집합**
- 모델 종류
  - **TCP/IP 4계층 모델**
  - **OSI 7계층 모델**
  
![download](https://github.com/DevTechGrowth/study_CS/assets/66158433/20803931-bffc-4d9d-9390-daf3d48b5b3b)

(※ 책에서는 TCP/IP의 Network Interface 계층을 링크 계층으로 표현)

### <목차>
1. [애플리케이션 계층](#1-애플리케이션-계층-application)
2. [전송 계층](#2-전송-계층-transport)
3. [인터넷 계층](#3-인터넷-계층)
4. [링크 계층](#4-링크-계층)

# TCP/IP 계층
- **네트워크**에서 사용되는 **통신 프로토콜의 집합**
- 프로토콜의 **네트워킹 범위에 따라** 네 개의 추상화 계층으로 구성
- 특정 계층을 변경해도 다른 계층에 영향을 주지 않도록 설계 (▷ 유연하게 설계)

## 1. 애플리케이션 계층 application
- 응용 프로그램(FTP, HTTP, SSH, SMTP, DNS 등)이 사용되는 프로토콜
  - 실질적으로 사람들에게 서비스를 제공하는 층
  - 웹 서비스, 이메일 등

## 2. 전송 계층 transport
- 송신자와 수신자를 연결하는 통신 서비스를 제공
- 연결 지향 데이터 스트림 지원, 신뢰성, 흐름 제어 제공
- 애플리케이션과 인터넷 계층 사이의 데이터가 전달될 때 중계

|특징|TCP|UDP|
|--|--|--|
|**신뢰성**|O</br>[3-way handshake](#tcp-연결-성립-과정)</br>(연결지향 프로토콜)|X|
|**패킷 사이의 순서 보장**|O|X|
|**수신 여부 확인**|O|X|
|**패킷 교환 방식**|가상회선 패킷 교환 방식|데이터그램 패킷 교환 방식|

### 가상회선 패킷 교환 방식
- 각 패킷에는 가상 회선 식별자가 포함됨
- 모든 패킷을 전송하면 가상회선이 해제되고 패킷들은 전송된 순서대로 도착

### 데이터그램 패킷 교환 방식
- 패킷이 독립적으로 이동하며 최적의 경로를 선택
- 하나의 메시지에서 분할된 여러 패킷은 서로 다른 경로로 전송될 수 있고, 도착 순서가 다를 수 있는 방식

### TCP 연결 성립 & 전송 & 해제 과정
![img1 daumcdn](https://github.com/DevTechGrowth/study_CS/assets/66158433/232345f3-837b-4850-8574-feda15888bc1)

### - TCP 연결 성립 과정 : 3-way handshake
3-way handshake → TCP 신뢰 확보 → 데이터 전송

|단계|From|To|전송하는 것|비고|
|--|--|--|--|--|
|1단계(SYN)|클라이언트|서버|SYN+클라이언트의 [ISN](https://github.com/DevTechGrowth/study_CS/blob/main/Network/%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC%20%EC%9A%A9%EC%96%B4%20%EC%A0%95%EB%A6%AC.md#isn)||
|2단계(SYN+ACK)|서버</br>(1단계의 SYN 수신)|클라이언트|서버의 ISN</br>승인번호(=클라이언트의 ISN+1)||
|3단계(ACK)|클라이언트|서버|승인번호(=서버의 ISN+1)||


### - TCP 연결 해제 과정 : 4-way handshake
|단계|상황|From|To|전송하는 것|결과|
|--|--|--|--|--|--|
|1단계(FIN)|클라이언트가 연결을 끊을 때|클라이언트|서버|FIN 세그먼트|클라이언트: FIN_WAIT_1 상태|
|2단계(ACK)||서버|클라이언트|ACK 승인 세그먼트|서버: CLOSE_WAIT 상태</br>클라이언트: ACK 수신 후 FIN_WAIT_2 상태|
|3단계(FIN)|2단계 후 일정 시간 경과 후|서버|클라이언트|FIN 세그먼트||
|4단계(ACK)|클라이언트: TIME_WAIT 상태|클라이언트|서버|ACK 세그먼트|서버: CLOSED 상태</br>클라이언트: 일정 시간 대기 후 닫힘|

**※ 클라이언트가 TIME_WAIT하는 이유**
- 지연 패킷 발생 경우 대비 : 뒤늦게 도착한 패킷 처리를 위해(데이터 무결성 예방)
- 두 장치가 연결이 닫혔는지 확인하기 위해 : 서버가 LAST_ACK 상태에서 닫히면 다시 새롭게 연결할 때 접속 오류 발


## 3. 인터넷 계층
- 장치로부터 받은 네트워크 패킷을 목적지(IP 주소)로 전송하는데 사용되는 계층
- 패킷을 수신해야할 상대 주소를 지정하여 데이터를 전달
- 특징 : 비연결형적(수신 여부 확인 X)
- ex) IP, ARP, ICMP 등

## 4. 링크 계층
- 네트워크 접근 계층
- 실질적으로 데이터를 전달. 장치 간에 신호를 주고 받는 규칙을 정하는 계층
- ex) 전선, 광섬유, 무선 등
- 종류
  - 물리 계층 : 무선 LAN, 유선 LAN을 통해 0과 1로 이루어진 데이터를 보내는 계층
  - 데이터 링크 계층 : 이더넷 프레임을 통해 에러 확인, 흐름 제어, 접근 제어를 담당하는 계층. 이더넷 프레임을 통해 전달받은 데이터의 에러를 검출하고 캡슐화)

### 유선 LAN(IEEE802.3)
**이더넷**
  - 유선 LAN을 이루고 있음
  - IEEE802.3 프로토콜 따름
  - 전이중화 통신 사용

**전이중화 통신(Full Duplex)**
  - 양쪽 장치가 동시에 송수신할 수 있는 방식
  - 송신로와 수신로가 나뉘어있음.

<img src=https://github.com/DevTechGrowth/study_CS/assets/66158433/47926748-3f7c-4e00-9b35-79a6fc792479 width="400" height="300"/>

**CSMA/CD (Carrier Sense Multiple Access with Collision Detection)**
  - 유선 LAN의 **반이중화** 통신 중 하나
  - 데이터를 보낸 이후 충동이 발생하면 일정 시간 이후 재전송하는 방식
  - 하나의 경로에서 송신과 수신을 모두 처리했기 대문(데이터를 보낼 때 충돌에 대비)


### 유선 LAN을 이루는 케이블
**트위스트 페어 케이블(Twisted Pair cable)**
  - TP 케이블이라고도 불림
  - 일반적으로 사용하는 LAN 케이블
  - 8개의 구리선을 2개씩 꼬아서 묶은 케이블
  - 종류 : UTP 케이블(구리선 실드 처리X), STP 케이블(구리선 실드 처리O)
  - cf) RJ-45 커넥터 : LAN 케이블을 꽂을 수 있는 커넥터

**광섬유 케이블**
  - 광섬유로 만듦
  - 레이저를 이용해 통신하할 때 사용
  - 장거리 및 고속 통신 가능
  - 섬유 내부에 들어간 빛이 내부에서 반사하며 전진하여 끝에 도달하는 방식으로 통신
  - 내외부를 다른 밀도의 유리나 플라스틱 섬유로 제작
  - 코어(core) : 빛의 굴절률이 높은 부분
  - 클래딩(cladding) : 빛의 굴절률이 낮은 부분

### 무선 LAN(IEEE802.11)
- WLAN : Wireless Local Area Network
- 같은 채널에서 송수신

**반이중화 통신(half duplex)**
  - 동시에 통신 X
  - 한 번에 한 방향만 통신 가능(수신을 시작하면 응답 전에 전송이 완료될 때까지 기다려야함)
  - 동시 전송으로 충돌 발생시 메시지 손실이나 왜곡 가능. 충돌 방지 시스템 필요
<img src=https://github.com/DevTechGrowth/study_CS/assets/66158433/d57f73af-9f47-4f1e-a76b-0249f29e599d width="400" height="300"/>

**CSMA/CA**
  - **반이중화 통신** 중 하나
  - 충돌 방지 시스템 : 데이터를 보내기 전에 캐리어 감지 등
    1. 데이터를 송신하기 전에 무선 매체를 살핌
    2. 캐리어 감지 : 회선이 비어 있는지를 판단
    3. IFS(Inter FrameSpace) : 랜덤 값을 기반으로 정해진 시간만큼 기다리며, 만약 무선 매체가 사용 중이면 점차 그 간격을 늘려가며 기다림
    4. 이후에 데이터를 송신

### 무선 LAN을 이루는 주파수
- 무선 신호 전달 방식을 이용하여 2대 이상의 장치를 연결하는 기술
- 공기에 주파수를 쏘아 무선 통신망 구축
- 주파수 대역 : 2.4GHz, 5GHz
  - 2.4GHz : 장애물에 강한 특성. 전자레인지, 무선 등 전파 간섭 발생 경우가 많음
  - 5GHz : 사용할 수 있는 채널 수가 많고 동시에 사용 가능. 더 깨끗한 전파 환경 구축 가능
- 무선 LAN을 이용한 기술 : 와이파이, 지그비, 블루투스

**와이파이(wifi)**
  - 전자기기들이 무선 LAN 신호에 연결 할 수 있게 하는 기술
  - 무선 접속 장치(AP, Access Point, 공유기) 필요
    - 유선 LAN에 흐르는 신호를 무선 LAN 신호로 바꿔, 신호가 닿는 범위 내에서 무선 인터넷 사용 가능

**BSS(Basic Service Set)**
  - 기본 서비스 집합
  - 동일 BSS 내에 있는 AP들과 장치들이 서로 통신 가능한 구조
  - 근거리 무선 통신 제공
  - 하나의 AP만을 기반으로 구축 → 사용자가 한 장소에서 다른 장소로 이동하며 네트워크 접속 불가능

**ESS(Extended Service Set)**
  - 하나 이상의 연결된 BSS 그룹
  - 장거리 무선 통신을 제공
  - 더 많은 가용성과 이동성 지원
  - 사용자가 한 장소에서 다른 장소로 이동하며 중단 없이 네트워크 접속 가능

### 이더넷 프레임
![download](https://github.com/DevTechGrowth/study_CS/assets/66158433/7fac00a2-dc9f-4882-9a35-988702a93cfb)

- Preamble : 이더넷 프레임이 시작임을 알림
- SFD(Start Frame Delimiter) : 다음 바이트부터 MAC 주소 필드가 시작됨을 알림
- DMAC, SMAC : 수신, 송신 MAC 주소
- EtherType : 데이터 계층 위의 계층인 IP 프로토콜을 정의(ex. IPv4, IPv6)
- Payload : 전달받은 데이터
- CRC : 에러 확인 비트


## 계층 간 데이터 송수신 과정
![image](https://github.com/DevTechGrowth/study_CS/assets/66158433/72da7217-db35-41b7-aa24-d462e59ff2fb)

애플리케이션 계층 ~> 전송 계층 : 요청값들이 캡슐화로 전달
링크 계층 ~> 애플리케이션 계층 : 비캡슐화로 데이터 전송

### 캡슐화 과정
![99803C415BA2F07C06](https://github.com/DevTechGrowth/study_CS/assets/66158433/34104287-429d-4fa0-82d4-02c429bc8d03)

- 상위 계층의 헤더와 데이터를 하위 계층의 데이터 부분에 포함시키고, 해당 계층의 헤더를 삽입하는 과정
- TCP(L4) 헤더 : 애플리케이션 계층 ~> 전송 계층으로 데이터 전달되어 '세그먼트' 또는 '데이터그램'화되고 붙여지는 헤더

### 비캡슐화 과정
![img1 daumcdn](https://github.com/DevTechGrowth/study_CS/assets/66158433/fa80d98b-9ea5-4aa1-a8e9-9cf97668a505)

- 하위 계층에서 상위 계층으로 가며 각 계층의 헤더 부분을 제거하는 과정
- 링크 계층 ~> 애플리케이션 계층
- 프레임화된 데이터 → 패킷화 → 세그먼트, 데이터그램화 => 메시지화

-----
### 참고자료
TCP 연결과 해제 사진 : [브런치-@dreaminz-5. TCP 연결과 해제](https://brunch.co.kr/@dreaminz/5)
